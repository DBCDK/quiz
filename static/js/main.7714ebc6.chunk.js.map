{"version":3,"sources":["redux/selectors.js","redux/openplatform.js","redux/actions.js","quizData.js","components/ImageDialog.js","components/quizElements.js","components/style.js","components/Widget.js","components/EditScreen.js","components/EditQuiz.js","components/QuizList.js","components/Admin.js","redux/sampleState.js","redux/quizElements.js","redux/reducers.js","redux/autosave.js","redux/store.js","index.js"],"names":["quizVariables","state","get","adminCurrentScreen","getIn","currentQuiz","currentScreen","screen","quizSettings","loading","searchResults","Immutable","fromJS","getScreen","screenId","searchQuery","toJS","storageUser","statistics","quizQuestionList","quiz","start","current","result","push","openplatformUser","sleep","t","Promise","resolve","setTimeout","getUser","_getUser","apply","this","arguments","_callee4","regenerator_default","a","wrap","_context4","prev","next","Object","asyncToGenerator","mark","_callee3","i","_o","_context3","ensureDbcOpenPlatform","t0","window","dbcOpenPlatform","status","fields","t1","sent","t2","t3","race","call","o","storage","user","abrupt","Error","stop","typeType","storageFn","_ref","_callee","_context","_x","delete","put","count","find","scan","_callee2","_context2","_owner","name","loadScript","url","reject","elem","document","createElement","src","onload","onerror","head","appendChild","_callee5","_context5","_callee6","token","_context6","connect","quizType","quizImageType","quizStatisticsType","openplatform","_x2","_connect","dispatchActionData","condition","atLeast","score","action","set","trophy","image","trophyImage","callback","infoScreenData","_ref2","_id","parent","ui","type","text","color","buttonText","log","answerButtonData","_ref3","nextScreen","increment","correct","questionCount","questionSectionData","_ref4","_ref5","id","questionText","defineProperty","nextSection","adminQuizList","dispatch","getState","searchQuizzes","showStatistics","_callee7","dayHits","screenHits","dispatchStat","fetchStat","_fetchStat","_context7","req","assign","_type","console","error","_x4","screenNames","hits","Array","from","keys","all","map","subtype","_x5","_","fromPairs","zip","filter","_ref6","slicedToArray","dayList","range","Date","now","d","toISOString","slice","_ref8","date","_x6","_x3","hideStatistics","undefined","addDispatch","deleteDispatch","objectSpread","updateDispatch","addQuestionAnswer","path","updateScreenElement","updateSetting","setting","addQuestionSection","_ref13","_ref12","before","questionId","uuidv4","nextId","screens","deleteSection","moveSection","editScreen","_ref14","screenAction","_ref15","_callee8","_searchQuery","query","ownOnly","visited","_context8","reverse","index","startsWith","limit","prefixScan","then","flatten","Set","has","val","add","_x7","_x8","_callee15","prefix","owner","_context15","concat","after","obj","forEach","key","changeSearchQuery","_ref16","_callee9","_context9","_x12","toggleSearchOwnOnly","_ref17","_callee10","_context10","_x13","addQuiz","_ref18","_callee11","_ref19","_context11","title","description","tags","style","primaryColor","secondaryColor","intro","done","won","retry","_x14","_x15","setQuiz","_ref20","_callee12","_context12","_x16","deleteQuiz","quizId","_ref21","_callee13","_context13","_x17","_x18","init","_ref22","onDone","_ref23","_callee14","_ref24","_ref25","_ref25$","_ref25$2","_ref25$3","_context14","fn","widget","initialised","statusCode","_x19","_x20","ImageDialog","_React$Component","_getPrototypeOf2","_this","classCallCheck","_len","length","args","_key","possibleConstructorReturn","getPrototypeOf","open","inherits","createClass","value","_openDialog","setState","t4","images","props","setImageUrl","_this2","react_default","Dialog_default","onClose","accept","className","classes","displayNone","onChange","e","fileData","reader","FileReader","readAsBinaryString","target","files","_data","chooseImage","DialogContent_default","Grid_default","container","spacing","item","xs","Typography_default","variant","float","marginTop","Button_default","onClick","Close_default","quizElements","media","view","imageUrl","width","TextField_default","fullWidth","label","htmlFor","component","Add_default","CircularProgress_default","textAlign","uuid","display","position","right","top","IconButton_default","aria-label","openDialog","Delete_default","fontSize","alt","marginBottom","React","Component","height","replace","Image","marked","setOptions","sanitize","renderer","Renderer","prevLinkRenderer","link","href","ytRegEx","vimeoRegEx","mediaTag","calculatedWidth","Math","floor","min","innerWidth","match","frameborder","allow","allowFullScreen","maxImageSize","edit","updateQuizElement","ImageDialog_ImageDialog","vars","headlineMapping","body1","dangerouslySetInnerHTML","__html","mustache","render","_ref7","multiline","rowsMax","buttonGroup","_ref9","_ref10","onAction","renderElement","pos","_ref11","answer","scoreIncrement","button","f","updateIn","margin","mini","deleteIn","setIn","max","borderRadius","theme","maxWidth","minHeight","innerHeight","maxHeight","overflow","input","opts","Widget","_Component","createMuiTheme","palette","primary","main","secondary","backgroundImage","styles","AppBar_default","Toolbar_default","quizTitle","background","backgroundSize","backgroundColor","element","withStyles","ownProps","settings","c","JSON","parse","r","g","b","editDispatch","doEditScreen","doUpdateDispatch","doDeleteDispatch","doAddDispatch","butLast","minScore","Paper_default","editCondition","last","EditScreen","_this$props","gutterBottom","ArrowBack_default","doUpdateScreenElement","doAddQuestionAnswer","editUI","updateFn","EditQuiz","questions","FormControl_default","InputLabel_default","Input_default","Tooltip_default","join","split","renderDescriptionSettings","onMoveSection","items","q","content","doEdit","doDelete","notDraggable","DragIndicator_default","noWrap","uiElem","quizSection","react_beautiful_dnd_esm","onDragEnd","destination","draggableId","source","to","droppableId","droppableProvided","droppableSnapshot","ref","innerRef","draggableProvided","draggableSnapshot","draggableProps","dragHandleProps","placeholder","renderQuestionList","lib","disableAlpha","onChangeComplete","hex","stringify","rgb","renderVisualSettings","questionList","DeleteButton","dialog","DialogTitle_default","DialogContentText_default","DialogActions_default","StatisticsDialog","screenStat","screenTitle","maxDay","values","question","List","results","first","sort","QuizList","_Component3","_this$props2","newQuiz","changeQuery","toggleOwnOnly","doSearch","userName","copy","InputProps","labelWidth","endAdornment","InputAdornment_default","Search_default","FormControlLabel_default","control","Switch_default","checked","QuizList_StatisticsDialog","List_default","isOwn","ListItem_default","ListItemText_default","tag","ListItemSecondaryAction_default","QuizList_DeleteButton","FileCopy_default","BarChart_default","Admin","components_EditScreen","components_EditQuiz","components_QuizList","sampleState","admin","quizState","imageType","page","deepReplace","v","addSection","prevSet","needsReplace","findScreenActions","child","equals","replaceInId","assert","merge","sectionScreens","sectionId","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","includes","err","return","toDelete","acc","isCollection","initialState","pageAction","_action$action","dispatchCase","ok","conditionType","variable","_loop","update","sortDispatchesByAtLeastScore","prevQuiz","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","createStore","newScreen","mergeDeep","movedElem","insertBeforeId","movedScreens","Map","answerScreen","buttonGroupUI","applyMiddleware","thunk","needsSave","doSave","mount","Cls","elemId","openPlatformToken","ReactDOM","es","getElementById","subscribe","quizData","openPlatformQuiz","addEventListener","initOpenPlatformQuiz","QuizWidget","QuizAdmin","statisticsEvent"],"mappings":"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","file":"static/js/main.7714ebc6.chunk.js","sourcesContent":["import Immutable from 'immutable';\n\nexport const ownQuizzes = state =>\n  state\n    .getIn(['widget', 'ownQuizzes'])\n    .map(uuid => state.getIn(['quiz', uuid]));\nexport const quizVariables = state => state.get('quizState');\nexport const adminCurrentScreen = state =>\n  state.getIn(['admin', 'currentScreen']);\nexport const currentQuiz = state => state.getIn(['quiz', '_id']);\nexport const currentScreen = state => {\n  const screen = state.getIn(\n    ['quiz', 'screens', state.getIn(['widget', 'currentScreen'])],\n    false\n  );\n  if (screen) {\n    return screen;\n  }\n  return state.getIn(['quiz', 'screens', state.getIn(['quiz', 'start'])]);\n};\nexport const quizSettings = state => state.getIn(['quiz']);\nexport const loading = state => state.getIn(['widget', 'loading']) !== 0;\nexport const searchResults = state =>\n  state.get('searchResults', Immutable.fromJS([]));\nexport const getScreen = (screenId, state) =>\n  state.getIn(['quiz', 'screens', screenId]);\nexport const searchQuery = state => state.get('searchQuery').toJS();\nexport const storageUser = state => state.getIn(['storage', 'user']);\nexport const statistics = state =>\n  state.get('statistics') && state.get('statistics').toJS();\n\nexport function quizQuestionList(quiz) {\n  if (!quiz) {\n    return [];\n  }\n  const start = quiz.get('start');\n  let current = start;\n  const result = [];\n  do {\n    result.push(current);\n    current = quiz.getIn(['screens', current, 'nextSection']);\n  } while (current && current !== start);\n  return result;\n}\nexport function questionList(state) {\n  return quizQuestionList(state.get('quiz'));\n}\n","let openplatformUser;\nfunction sleep(t) {\n  return new Promise(resolve => setTimeout(resolve, t * 1000));\n}\nexport async function getUser() {\n  if (!openplatformUser) {\n    openplatformUser = (async () => {\n      await ensureDbcOpenPlatform();\n      let o;\n      for (let i = 1; i < 10; ++i) {\n        const o = await Promise.race([\n          await window.dbcOpenPlatform.status({fields: ['storage']}),\n          sleep(i)\n        ]);\n        if (o && o.storage && o.storage.user) {\n          return o.storage.user;\n        }\n      }\n      throw new Error(o ? o : 'Error getting storage user');\n    })();\n  }\n  return await openplatformUser;\n}\n\nconst storageFn = async o => {\n  await ensureDbcOpenPlatform();\n  return await window.dbcOpenPlatform.storage(o);\n};\n\nlet typeType;\nexport const storage = {\n  get: o => storageFn({get: o}),\n  delete: o => storageFn({delete: o}),\n  put: o => storageFn({put: o}),\n  count: o => storageFn({count: o}),\n  find: o => storageFn({find: o}),\n  scan: o => storageFn({scan: o}),\n  typeType: () => {\n    if (!typeType) {\n      typeType = Promise.resolve(\n        (async () =>\n          (await storage.find({_owner: 'openplatform', name: 'type'}))[0])()\n      );\n    }\n    return typeType;\n  }\n};\nfunction loadScript(url) {\n  return new Promise((resolve, reject) => {\n    const elem = document.createElement('script');\n    elem.src = url;\n    elem.onload = resolve;\n    elem.onerror = reject;\n    document.head.appendChild(elem);\n  });\n}\nasync function ensureDbcOpenPlatform() {\n  if (!window.dbcOpenPlatform) {\n    await loadScript('https://openplatform.dbc.dk/v3/dbc_openplatform.min.js');\n  }\n}\nexport async function connect(token) {\n  await ensureDbcOpenPlatform();\n  const result = await window.dbcOpenPlatform.connect(token);\n  return result;\n}\n\nexport default {connect, storage, getUser};\n","import {getUser, storage} from './openplatform';\nimport Immutable from 'immutable';\nimport {searchQuery} from './selectors';\nimport {quizData, questionSectionData} from '../quizData';\nimport uuidv4 from 'uuid/v4';\nimport _ from 'lodash';\n\nexport const adminQuizList = () => async (dispatch, getState) => {\n  // TODO sync quiz to store\n  await searchQuizzes()(dispatch, getState);\n  dispatch({\n    type: 'ADMIN_QUIZ_LIST'\n  });\n};\n\nexport const showStatistics = quiz => async dispatch => {\n  let dayHits = {};\n  let screenHits = {};\n\n  function dispatchStat() {\n    dispatch({\n      type: 'STATISTICS',\n      statistics: Immutable.fromJS({quiz, dayHits, screenHits})\n    });\n  }\n\n  async function fetchStat(req) {\n    req = Object.assign(\n      {\n        _type: 'openplatform.quizStatistics',\n        quiz: quiz.get('_id'),\n        type: 'screen'\n      },\n      req\n    );\n    try {\n      return await storage.count(req);\n    } catch (e) {\n      console.error(e);\n      return 0;\n    }\n  }\n\n  dispatchStat();\n\n  (async () => {\n    const screenNames = Array.from(quiz.get('screens').keys());\n    const hits = await Promise.all(\n      screenNames.map(async name => fetchStat({subtype: name}))\n    );\n    screenHits = _.fromPairs(\n      _.zip(screenNames, hits).filter(([_, count]) => count > 0)\n    );\n    dispatchStat();\n  })();\n\n  (async () => {\n    const day = 24 * 60 * 60 * 1000;\n    const dayList = _.range(Date.now() - 31 * day, Date.now() + 1, day).map(d =>\n      new Date(d).toISOString().slice(0, 10)\n    );\n    const hits = await Promise.all(\n      dayList.map(async date =>\n        fetchStat({\n          date,\n          subtype: quiz.get('start')\n        })\n      )\n    );\n    dayHits = _.fromPairs(_.zip(dayList, hits));\n    dispatchStat();\n  })();\n};\nexport const hideStatistics = () => {\n  return {\n    type: 'STATISTICS',\n    statistics: undefined\n  };\n};\n\nexport const addDispatch = screen => {\n  return {\n    type: 'ADD_DISPATCH',\n    screen\n  };\n};\nexport const deleteDispatch = o => {\n  return {\n    type: 'DELETE_DISPATCH',\n    ...o\n  };\n};\nexport const updateDispatch = o => {\n  return {\n    type: 'UPDATE_DISPATCH',\n    ...o\n  };\n};\nexport const addQuestionAnswer = path => {\n  return {\n    type: 'ADD_QUESTION_ANSWER',\n    path: path\n  };\n};\nexport const updateScreenElement = o => {\n  return {\n    type: 'UPDATE_SCREEN_ELEMENT',\n    ...o\n  };\n};\nexport const updateSetting = (path, setting) => ({\n  type: 'UPDATE_QUIZ_SETTING',\n  path,\n  setting\n});\nexport const addSection = ({before, screenId, screens}) => ({\n  type: 'ADMIN_ADD_SECTION',\n  before,\n  screenId,\n  screens\n});\nexport const addQuestionSection = ({before}) => {\n  const questionId = uuidv4();\n  const nextId = uuidv4();\n  return addSection({\n    before,\n    screenId: questionId,\n    screens: questionSectionData({id: questionId, nextScreen: nextId})\n  });\n};\n\nexport const deleteSection = screenId => ({\n  type: 'ADMIN_DELETE_SECTION',\n  screenId\n});\nexport const moveSection = o => {\n  return {type: 'ADMIN_MOVE_SECTION', ...o};\n};\nexport const editScreen = ({screen}) => ({type: 'ADMIN_EDIT_SCREEN', screen});\nexport const screenAction = action => ({type: 'PAGE_ACTION', action});\nlet quizType, quizImageType, quizStatisticsType, user;\nexport const searchQuizzes = () => async (dispatch, getState) => {\n  dispatch({type: 'SEARCH_RESULTS', searchResults: []});\n  const {query, ownOnly} = searchQuery(getState());\n  let result;\n  if (!query) {\n    if (ownOnly) {\n      result = await storage.scan({\n        reverse: true,\n        _type: quizType,\n        index: ['_owner', '_version'],\n        startsWith: [user]\n      });\n    } else {\n      result = await storage.scan({\n        reverse: true,\n        _type: quizType,\n        index: ['_version'],\n        startsWith: [],\n        limit: 100\n      });\n    }\n  } else {\n    result = _.flatten(\n      await Promise.all([\n        prefixScan(query, ['_version'], ownOnly && user),\n        prefixScan(query, ['title', '_version'], ownOnly && user),\n        prefixScan(query, ['tags', '_version'], ownOnly && user),\n        prefixScan(query, ['_owner', '_version']).then(result =>\n          result.filter(o => (ownOnly ? o._owner === user : true))\n        )\n      ])\n    );\n  }\n\n  const visited = new Set();\n  result = result.filter(o => !visited.has(o.val) && visited.add(o.val));\n\n  result = await Promise.all(result.map(o => storage.get({_id: o.val})));\n  dispatch({type: 'SEARCH_RESULTS', searchResults: result, query, ownOnly});\n  return result;\n};\nasync function prefixScan(prefix, index, owner) {\n  const result = await storage.scan({\n    reverse: true,\n    _type: quizType,\n    index: owner ? ['_owner'].concat(index) : index,\n    startsWith: [],\n    after: owner ? [owner, prefix] : [prefix],\n    before: owner ? [owner, prefix + 'zzzzzzzzzz'] : [prefix + 'zzzzzzzzzz'],\n    limit: 100\n  });\n  return result.map(o => {\n    const obj = {};\n    index.forEach((key, i) => (obj[key] = o.key[i]));\n    obj.val = o.val;\n    return obj;\n  });\n}\nexport const changeSearchQuery = query => async dispatch => {\n  dispatch({\n    type: 'SEARCH_CHANGE_QUERY',\n    query\n  });\n  dispatch(searchQuizzes());\n};\nexport const toggleSearchOwnOnly = query => async dispatch => {\n  dispatch({type: 'SEARCH_TOGGLE_OWN_ONLY'});\n  dispatch(searchQuizzes());\n};\nexport const addQuiz = quiz => async (dispatch, getState) => {\n  const {_id} = await storage.put(\n    Object.assign({}, quiz ? quiz.toJS() : quizData(), {\n      _type: quizType,\n      _id: undefined\n    })\n  );\n  dispatch({\n    type: 'SEARCH_CHANGE_QUERY',\n    query: ''\n  });\n  await searchQuizzes()(dispatch, getState);\n  dispatch({\n    type: 'SET_QUIZ',\n    quiz: await storage.get({_id})\n  });\n};\nexport const setQuiz = quiz => async dispatch => {\n  quiz = Immutable.fromJS(quiz);\n  dispatch({type: 'SET_QUIZ', quiz});\n};\nexport const deleteQuiz = quizId => async (dispatch, getState) => {\n  await storage.delete({_id: quizId});\n  await searchQuizzes()(dispatch, getState);\n};\nexport const init = ({onDone, quizId}) => async (dispatch, getState) => {\n  dispatch({type: 'LOADING_STARTED'});\n\n  user = await getUser();\n  if (!user) {\n    return dispatch({type: 'LOADING_DONE'});\n  }\n  if (onDone) {\n    dispatch({type: 'ONDONE_CALLBACK', fn: onDone});\n  }\n\n  [[quizType], [quizImageType], [quizStatisticsType]] = await Promise.all([\n    storage.find({\n      _owner: 'openplatform',\n      name: 'quiz',\n      _type: 'openplatform.type'\n    }),\n    storage.find({\n      _owner: 'openplatform',\n      name: 'quizImage',\n      _type: 'openplatform.type'\n    }),\n    storage.find({\n      _owner: 'openplatform',\n      name: 'quizStatistics',\n      _type: 'openplatform.type'\n    })\n  ]);\n  dispatch({\n    type: 'INITIALISED',\n    state: {\n      widget: {\n        initialised: true\n      },\n      storage: {\n        user,\n        quizImageType,\n        quizType,\n        quizStatisticsType\n      }\n    }\n  });\n\n  if (quizId) {\n    try {\n      const quiz = await storage.get({_id: quizId});\n      dispatch(setQuiz(quiz));\n      return dispatch({type: 'LOADING_DONE'});\n    } catch (e) {\n      if (e.statusCode === 404) {\n        // TODO handle 404\n        dispatch(\n          setQuiz({\n            _id: quizId,\n            title: '404 quiz not found',\n            description: 'error',\n            tags: [],\n            start: 'error',\n            screens: {\n              error: {\n                _id: 'error',\n                ui: [\n                  {\n                    type: 'text',\n                    text: `Error: quiz \"${quizId}\" not found (404)`\n                  }\n                ],\n                log: true\n              }\n            }\n          })\n        );\n      }\n      console.log(e);\n    }\n  }\n  await searchQuizzes()(dispatch, getState);\n  return dispatch({type: 'LOADING_DONE'});\n};\n","export const dispatchActionData = ({score, screen, trophyImage}) => ({\n  condition: {atLeast: {score: score || 0}},\n  action: {\n    screen,\n    set: {trophy: {image: trophyImage || ''}},\n    callback: true\n  }\n});\nexport const infoScreenData = ({_id, parent, action, text, buttonText}) => ({\n  _id,\n  parent,\n  ui: [\n    {\n      type: 'media',\n      url: ''\n    },\n    {\n      type: 'text',\n      text: text || 'Forklaring af resultatet'\n    },\n    {\n      type: 'button',\n      color: 'primary',\n      text: buttonText || 'videre',\n      action\n    }\n  ],\n  log: true\n});\nexport const answerButtonData = ({nextScreen, score, text}) => ({\n  type: 'button',\n  color: 'primary',\n  text: text || 'Tekst på svarknap',\n  action: {\n    screen: nextScreen,\n    increment: {score: score || 0, correct: score ? 1 : 0, questionCount: 1}\n  }\n});\nexport const questionSectionData = ({id, nextScreen, questionText}) => ({\n  [id]: {\n    _id: id,\n    nextSection: nextScreen,\n    ui: [\n      {\n        type: 'media',\n        url: ''\n      },\n      {type: 'text', text: questionText || 'Spørgsmål?'},\n      {\n        type: 'buttonGroup',\n        ui: [\n          answerButtonData({nextScreen: id + 'answer1', text: 'Forkert svar'}),\n          answerButtonData({\n            nextScreen: id + 'answer2',\n            score: 1,\n            text: 'Rigtigt svar'\n          })\n        ]\n      },\n      {type: 'spacing'},\n      {\n        type: 'button',\n        color: 'secondary',\n        text: 'hjælp',\n        action: {screen: id + 'help'}\n      }\n    ]\n  },\n  [id + 'help']: infoScreenData({\n    _id: id + 'help',\n    parent: id,\n    action: {screen: id},\n    text: 'Her er et hint...'\n  }),\n  [id + 'answer1']: infoScreenData({\n    _id: id + 'answer1',\n    parent: id,\n    action: {screen: nextScreen},\n    text: '# Forkert svar\\n\\nDet rigtige svar er ... fordi...'\n  }),\n  [id + 'answer2']: infoScreenData({\n    _id: id + 'answer2',\n    parent: id,\n    action: {screen: nextScreen},\n    text: '# Rigtigt svar\\n\\nDet var rigtigt fordi...'\n  })\n});\nexport const quizData = () => ({\n  _type: 'quiz',\n  _id: 'quizId',\n  title: 'Titel for ny quiz',\n  description: 'Beskrivelse af den nye quiz',\n  tags: ['nøgleord1', 'nøgleord2'],\n  style: {\n    primaryColor: '#0b6f9f',\n    secondaryColor: '#768e87'\n  },\n  start: 'intro',\n  screens: {\n    intro: {\n      start: true,\n      nextSection: 'question1',\n      ...infoScreenData({\n        _id: 'intro',\n        text: '# Velkommen til quizzen\\n\\n Tilføj mere intro-tekst her...',\n        buttonText: 'Start',\n        action: {\n          screen: 'question1',\n          set: {\n            score: 0,\n            correct: 0,\n            questionCount: 0\n          }\n        }\n      })\n    },\n    ...questionSectionData({\n      id: 'question1',\n      nextScreen: 'question2',\n      questionText: 'Hvad er svaret på spørgsmål 1?'\n    }),\n    ...questionSectionData({\n      id: 'question2',\n      nextScreen: 'done',\n      questionText: 'Hvad er svaret på spørgsmål 2?'\n    }),\n    done: {\n      _id: 'done',\n      nextSection: 'intro',\n      dispatch: [\n        dispatchActionData({\n          score: 1,\n          screen: 'won',\n          trophyImage: 'http://...'\n        }),\n        dispatchActionData({score: -1, screen: 'retry', trophyImage: ''})\n      ]\n    },\n    won: infoScreenData({\n      _id: 'won',\n      parent: 'done',\n      text: 'Tillykke, du havde {{correct}} ud af {{questionCount}} rigtige',\n      action: {screen: 'intro'},\n      buttonText: 'Prøv igen'\n    }),\n    retry: infoScreenData({\n      _id: 'won',\n      parent: 'done',\n      text: 'Prøv igen...',\n      action: {screen: 'intro'},\n      buttonText: 'Prøv igen'\n    })\n  }\n});\n","import React from 'react';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport AddIcon from '@material-ui/icons/Add';\nimport Grid from '@material-ui/core/Grid';\nimport TextField from '@material-ui/core/TextField';\nimport Typography from '@material-ui/core/Typography';\nimport {storage, getUser} from '../redux/openplatform';\nimport Button from '@material-ui/core/Button';\nimport IconButton from '@material-ui/core/IconButton';\nimport CloseIcon from '@material-ui/icons/Close';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport quizElements from './quizElements';\n\nexport class ImageDialog extends React.Component {\n  state = {\n    open: false,\n    loading: false\n  };\n  async openDialog() {\n    this.setState({open: true, loading: true});\n    let result = await storage.scan({\n      reverse: true,\n      _type: 'openplatform.quizImage',\n      index: ['_owner', '_version'],\n      startsWith: [await getUser()]\n    });\n    this.setState({loading: false, images: result.map(o => o.val)});\n  }\n  chooseImage(id) {\n    this.props.setImageUrl('openplatform:' + id);\n    this.setState({open: false});\n  }\n  render() {\n    if (!this.state.open) {\n      return (\n        <Button onClick={() => this.openDialog()}>\n          {this.props.title || 'Vælg billede'}\n        </Button>\n      );\n    }\n    return (\n      <Dialog open={true} onClose={() => this.setState({open: false})}>\n        <input\n          accept=\"image/jpeg\"\n          className={(this.props.classes || {}).displayNone}\n          id=\"uploadImageFile\"\n          type=\"file\"\n          onChange={async e => {\n            try {\n              this.setState({open: true, loading: true});\n              const fileData = await new Promise((resolve, reject) => {\n                const reader = new FileReader();\n                reader.readAsBinaryString(e.target.files[0]);\n                reader.onload = () => resolve(reader.result);\n                reader.onerror = reject;\n              });\n              const {_id} = await storage.put({\n                _type: 'openplatform.quizImage',\n                _data: fileData\n              });\n              this.chooseImage(_id);\n            } catch (e) {\n              // TODO show error\n            }\n          }}\n        />\n        <DialogContent>\n          <Grid container spacing={16}>\n            <Grid item xs={12}>\n              <Typography variant=\"h6\">\n                <span style={{float: 'right', marginTop: 16}}>\n                  <Button onClick={() => this.setState({open: false})}>\n                    <CloseIcon />\n                  </Button>\n                </span>\n                <br />\n                Vælg billede\n              </Typography>\n            </Grid>\n            <Grid item xs={12}>\n              {quizElements.media.view(\n                {url: this.props.imageUrl},\n                {classes: this.props.classes, width: 120}\n              )}\n            </Grid>\n            <Grid item xs={8}>\n              <TextField\n                fullWidth\n                label=\"Url for billede eller youtube/vimeo-video\"\n                value={this.props.imageUrl}\n                onChange={e => this.props.setImageUrl(e.target.value)}\n              />\n            </Grid>\n            <Grid item xs={4}>\n              <label htmlFor=\"uploadImageFile\">\n                <Button component=\"span\">\n                  <AddIcon /> Upload billede\n                </Button>\n              </label>\n            </Grid>\n            <Grid item xs={12} />\n            {this.state.loading ? (\n              <center>\n                <CircularProgress />\n              </center>\n            ) : (\n              // TODO: use style class instead of inline styling\n              <div style={{textAlign: 'justify'}}>\n                <Typography>Mine billeder:</Typography>\n                {this.state.images.map(uuid => [\n                  <span style={{display: 'inline-block', position: 'relative'}}>\n                    <span style={{position: 'absolute', right: -8, top: -8}}>\n                      <IconButton\n                        aria-label=\"Delete\"\n                        onClick={async () => {\n                          this.setState({loading: true});\n                          await storage.delete({_id: uuid});\n                          this.openDialog();\n                        }}\n                      >\n                        <DeleteIcon fontSize=\"small\" />\n                      </IconButton>\n                    </span>\n                    <img\n                      alt=\"\"\n                      onClick={() => this.chooseImage(uuid)}\n                      style={{marginBottom: 8}}\n                      src={\n                        'https://openplatform.dbc.dk/v3/storage/' +\n                        uuid +\n                        '?height=80'\n                      }\n                    />\n                  </span>,\n                  ' '\n                ])}\n              </div>\n            )}\n          </Grid>\n        </DialogContent>\n      </Dialog>\n    );\n  }\n}\nexport function imageUrl({url, width, height}) {\n  if (url.startsWith('openplatform:')) {\n    url =\n      url.replace('openplatform:', 'https://openplatform.dbc.dk/v3/storage/') +\n      (width ? '?width=' + width : height ? '?height=' + height : '');\n  }\n  return url;\n}\nexport function Image({url, width, height, alt, className, style}) {\n  return (\n    <img\n      src={imageUrl({url, width, height})}\n      alt={alt || ''}\n      width={width}\n      height={height}\n      className={className}\n      style={style}\n    />\n  );\n}\n","import React from 'react';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport AddIcon from '@material-ui/icons/Add';\nimport Button from '@material-ui/core/Button';\nimport Grid from '@material-ui/core/Grid';\nimport TextField from '@material-ui/core/TextField';\nimport Typography from '@material-ui/core/Typography';\nimport mustache from 'mustache';\nimport Immutable from 'immutable';\nimport marked from 'marked';\nimport {Image, ImageDialog} from './ImageDialog';\n\nmarked.setOptions({sanitize: true});\nvar renderer = new marked.Renderer();\nconst prevLinkRenderer = renderer.link;\nrenderer.link = function(href, title, text) {\n  return prevLinkRenderer\n    .call(this, href, title, text)\n    .replace('<a ', '<a target=\"_blank\" ');\n};\n\nconst quizElements = {\n  media: {\n    view: ({url, image}, {classes, width}) => {\n      url = url || image || '';\n      const ytRegEx = /https?:[/][/][^/]*youtube.com[/].*v=([^&]*).*/;\n      const vimeoRegEx = /https?:[/][/][^/]*vimeo.com[/].*?([0-9][0-9][0-9][0-9]+).*/;\n      if (typeof url !== 'string' || url === '') {\n        return;\n      }\n\n      let mediaTag;\n\n      const calculatedWidth = Math.floor(\n        width || Math.min(window.innerWidth * 0.95, 960) * 0.8\n      );\n      if (url.match(ytRegEx)) {\n        const height = calculatedWidth * 0.5625;\n        mediaTag = (\n          <iframe\n            title=\"YouTube Video\"\n            width={calculatedWidth}\n            height={height}\n            src={\n              'https://www.youtube.com/embed/' +\n              url.match(ytRegEx)[1] +\n              '?autoplay=0'\n            }\n            frameborder=\"0\"\n            allow=\"autoplay; encrypted-media\"\n            allowFullScreen\n          />\n        );\n      } else if (url.match(vimeoRegEx)) {\n        const height = calculatedWidth * 0.5625;\n        mediaTag = (\n          <iframe\n            title=\"Vimeo Video\"\n            src={\n              'https://player.vimeo.com/video/' +\n              url.match(vimeoRegEx)[1] +\n              '?autoplay=0'\n            }\n            width={calculatedWidth}\n            height={height}\n            frameborder=\"0\"\n            allow=\"autoplay; encrypted-media\"\n            allowFullScreen\n          />\n        );\n      } else {\n        mediaTag = (\n          <Image url={url} width={width} className={classes.maxImageSize} />\n        );\n      }\n      return <center>{mediaTag}</center>;\n    },\n    edit: ({url, image}, {updateQuizElement, classes}) => {\n      url = url || image || '';\n      return (\n        <div>\n          {quizElements.media.view({url}, {classes})}\n          <br />\n          <ImageDialog\n            classes={classes}\n            imageUrl={url}\n            setImageUrl={imageUrl =>\n              updateQuizElement(ui => ui.set('url', imageUrl))\n            }\n          />\n        </div>\n      );\n    }\n  },\n  spacing: {\n    view: () => <p />,\n    edit: () => <p />\n  },\n  text: {\n    view: ({text}, {vars}) => {\n      if (!text) {\n        return;\n      }\n      return (\n        <Typography headlineMapping={{body1: 'div'}}>\n          <div\n            dangerouslySetInnerHTML={{\n              __html: marked(mustache.render(text, vars || {}), {renderer})\n            }}\n          />\n        </Typography>\n      );\n    },\n\n    edit: ({text}, {updateQuizElement, classes, vars}) => (\n      <Grid container spacing={16}>\n        <Grid item xs={6}>\n          <TextField\n            label=\"Tekst\"\n            fullWidth\n            multiline\n            rowsMax=\"8\"\n            value={text}\n            onChange={e =>\n              updateQuizElement(ui => ui.set('text', e.target.value))\n            }\n          />\n        </Grid>\n        <Grid item xs={6}>\n          {quizElements.text.view({text}, {vars})}\n        </Grid>\n      </Grid>\n    )\n  },\n  buttonGroup: {\n    view: ({ui}, {onAction, renderElement}) => (\n      <Grid container spacing={16}>\n        {ui.map((o, pos) => (\n          <Grid item key={pos} xs={6}>\n            {renderElement(o, {onAction})}\n          </Grid>\n        ))}\n      </Grid>\n    ),\n    edit: ({ui}, props) => {\n      const {updateQuizElement, classes, addQuestionAnswer} = props;\n      return (\n        <Grid container spacing={16}>\n          {ui.map((answer, pos) => {\n            const scoreIncrement =\n              (answer.action &&\n                answer.action.increment &&\n                +answer.action.increment.score) ||\n              0;\n            return (\n              <Grid item key={pos} xs={6}>\n                {answer.type === 'button' &&\n                  quizElements.button.edit(answer, {\n                    ...props,\n                    updateQuizElement: f =>\n                      updateQuizElement(o => o.updateIn(['ui', pos], f))\n                  })}\n                <Button\n                  className={classes.margin}\n                  variant=\"fab\"\n                  aria-label=\"Delete\"\n                  mini\n                  onClick={() =>\n                    updateQuizElement(o => o.deleteIn(['ui', pos]))\n                  }\n                >\n                  <DeleteIcon />\n                </Button>\n                <TextField\n                  label=\"Point for svar\"\n                  value={scoreIncrement}\n                  onChange={e =>\n                    updateQuizElement(o =>\n                      o.setIn(\n                        ['ui', pos, 'action', 'increment'],\n                        Immutable.fromJS({\n                          score: Math.max(+e.target.value, 0),\n                          correct: +e.target.value ? 1 : 0\n                        })\n                      )\n                    )\n                  }\n                  type=\"number\"\n                  className={classes.margin}\n                />\n              </Grid>\n            );\n          })}\n          <Grid item xs={12}>\n            <Button aria-label=\"Add\" mini onClick={addQuestionAnswer}>\n              <AddIcon /> svar\n            </Button>\n          </Grid>\n        </Grid>\n      );\n    }\n  },\n  button: {\n    view: ({text, action, color, image}, {onAction, classes}) => {\n      if (!text && !image) {\n        return;\n      }\n      return (\n        <Button\n          fullWidth={true}\n          variant=\"contained\"\n          color={color}\n          onClick={() => onAction(action)}\n        >\n          {image && (\n            <Image\n              url={image}\n              style={{borderRadius: 4}}\n              height={64}\n              alt={text}\n            />\n          )}\n          {image && <span>&nbsp;</span>}\n          {text}\n        </Button>\n      );\n    },\n    edit: (\n      {text, action, color, image},\n      {updateQuizElement, editScreen, classes}\n    ) => (\n      <div>\n        {quizElements.button.view(\n          {text, action, color, image},\n          {onAction: () => editScreen(action.screen), classes}\n        )}\n        <br />\n        <TextField\n          fullWidth\n          className={classes.margin}\n          label=\"Tekst til knap\"\n          value={text}\n          onChange={e =>\n            updateQuizElement(ui => ui.set('text', e.target.value))\n          }\n        />\n        <ImageDialog\n          classes={classes}\n          imageUrl={image}\n          title=\"Vælg Knap-billede\"\n          setImageUrl={imageUrl => {\n            updateQuizElement(ui => ui.set('image', imageUrl));\n          }}\n        />\n        <Button onClick={() => updateQuizElement(ui => ui.set('image', ''))}>\n          Fjen knap-billede\n        </Button>\n      </div>\n    )\n  }\n};\nexport default quizElements;\n","const style = theme => ({\n  displayNone: {\n    display: 'none'\n  },\n  container: {\n    maxWidth: Math.min(window.innerWidth * 0.95, 960),\n    minHeight: window.innerHeight - 64,\n    textAlign: 'left'\n  },\n  maxImageSize: {\n    maxWidth: 0.8 * Math.min(window.innerWidth * 0.95, 960),\n    maxHeight: 0.5 * window.innerHeight\n  },\n  button: {\n    overflow: 'hidden',\n    height: 36\n  },\n  margin: {\n    margin: 8\n  },\n  input: {\n    display: 'none'\n  }\n});\nexport default style;\n","import React, {Component} from 'react';\nimport {connect} from 'react-redux';\nimport {\n  currentScreen,\n  quizVariables,\n  quizSettings,\n  loading\n} from '../redux/selectors';\nimport {screenAction} from '../redux/actions';\nimport AppBar from '@material-ui/core/AppBar';\nimport Grid from '@material-ui/core/Grid';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport Typography from '@material-ui/core/Typography';\nimport quizElements from './quizElements';\nimport {imageUrl} from './ImageDialog';\n\nimport {withStyles} from '@material-ui/core/styles';\nimport style from './style';\n\nimport {MuiThemeProvider, createMuiTheme} from '@material-ui/core/styles';\n\nconst spacing = 16;\n\nfunction renderElement(o, opts) {\n  if (!quizElements[o.type]) {\n    console.log('cannot find viewtype:', o.type);\n    return;\n  }\n  return quizElements[o.type].view(o, {...opts, renderElement});\n}\n\nexport class Widget extends Component {\n  render() {\n    const theme = createMuiTheme({\n      palette: {\n        primary: {\n          main: this.props.primaryColor || '#ccc'\n        },\n        secondary: {\n          main: this.props.secondaryColor || '#ccc'\n        }\n      }\n    });\n    const classes = this.props.classes || undefined;\n    let backgroundImage = this.props.backgroundImage;\n    return (\n      <MuiThemeProvider theme={theme}>\n        <AppBar position=\"static\" color=\"primary\">\n          <Toolbar>\n            <Typography variant=\"h6\" color=\"inherit\">\n              {this.props.quizTitle}\n            </Typography>\n          </Toolbar>\n        </AppBar>\n        <center\n          style={{\n            background:\n              backgroundImage &&\n              `url(\"${imageUrl({\n                url: backgroundImage,\n                width: window.innerWidth\n              })}\") no-repeat center center fixed`,\n            backgroundSize: 'cover'\n          }}\n        >\n          <div style={{backgroundColor: this.props.backgroundColor}}>\n            <Grid container spacing={spacing} className={classes.container}>\n              <Grid item xs={12} />\n              {this.props.ui &&\n                this.props.ui.map((o, pos) => {\n                  const element = renderElement(o.toJS(), {\n                    onAction: this.props.onAction,\n                    classes,\n                    vars: this.props.vars.toJS()\n                  });\n                  if (!element) {\n                    return undefined;\n                  }\n                  return (\n                    element && (\n                      <Grid key={pos} item xs={12}>\n                        {element}\n                      </Grid>\n                    )\n                  );\n                })}\n            </Grid>\n          </div>\n        </center>\n      </MuiThemeProvider>\n    );\n  }\n}\n\nexport function mapStateToProps(state, ownProps) {\n  const screen = currentScreen(state);\n  if (!screen) {\n    return <div>\"Quiz screen missing or loading...\"</div>;\n  }\n  const settings = quizSettings(state);\n  let backgroundColor;\n  try {\n    const c = JSON.parse(settings.getIn(['style', 'backgroundColor']));\n    backgroundColor = `rgba(${c.r},${c.g},${c.b},${c.a})`;\n  } catch (e) {\n    backgroundColor = `rgba(255,255,255,0.7)`;\n  }\n  return {\n    loading: loading(state),\n    vars: quizVariables(state),\n    quizTitle: settings.get('title'),\n    ui: screen.get('ui'),\n    backgroundImage: settings.getIn(['backgroundImage']),\n    primaryColor: settings.getIn(['style', 'primaryColor']),\n    secondaryColor: settings.getIn(['style', 'secondaryColor']),\n    backgroundColor\n  };\n}\n\nexport function mapDispatchToProps(dispatch, ownProps) {\n  return {\n    onAction: action => dispatch(screenAction(action))\n  };\n}\n\nexport default withStyles(style)(\n  connect(\n    mapStateToProps,\n    mapDispatchToProps\n  )(Widget)\n);\n","import {connect} from 'react-redux';\nimport React, {Component} from 'react';\nimport Immutable from 'immutable';\n\nimport ArrowBackIcon from '@material-ui/icons/ArrowBack';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport AddIcon from '@material-ui/icons/Add';\nimport Button from '@material-ui/core/Button';\nimport Paper from '@material-ui/core/Paper';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport {withStyles} from '@material-ui/core/styles';\nimport TextField from '@material-ui/core/TextField';\nimport {Image, ImageDialog} from './ImageDialog';\n\nimport {adminCurrentScreen, getScreen} from '../redux/selectors';\nimport {\n  editScreen,\n  updateScreenElement,\n  addQuestionAnswer,\n  updateDispatch,\n  deleteDispatch,\n  addDispatch\n} from '../redux/actions';\nimport quizElements from './quizElements';\nimport style from './style';\n\nfunction editUI({\n  currentScreen,\n  classes,\n  doEditScreen,\n  doUpdateScreenElement,\n  doAddQuestionAnswer\n}) {\n  return currentScreen.get('ui').map((o, pos) => (\n    <Grid key={pos} item xs={12}>\n      {quizElements[o.get('type')].edit &&\n        quizElements[o.get('type')].edit(o.toJS(), {\n          classes,\n          editScreen: doEditScreen,\n          addQuestionAnswer: () =>\n            doAddQuestionAnswer(currentScreen.get('_id'), pos),\n          updateQuizElement: doUpdateScreenElement(\n            currentScreen.get('_id'),\n            pos\n          )\n        })}\n    </Grid>\n  ));\n}\nfunction editCondition(\n  condition,\n  {classes, doEditScreen, doUpdateDispatch, doDeleteDispatch}\n) {\n  const minScore = condition.getIn(['condition', 'atLeast', 'score']);\n  return (\n    <Grid item xs={12} key={condition.getIn(['action', 'screen'])}>\n      <Paper>\n        <Image\n          height={64}\n          url={condition.getIn(['action', 'set', 'trophy', 'image'], '')}\n        />\n        <br />\n        <TextField\n          label=\"Mindste antal point\"\n          value={minScore}\n          onChange={e =>\n            doUpdateDispatch(o =>\n              o.set(\n                'condition',\n                Immutable.fromJS({\n                  atLeast: {score: Math.max(0, e.target.value)}\n                })\n              )\n            )\n          }\n          type=\"number\"\n          className={classes.margin}\n        />\n        <Button\n          variant=\"contained\"\n          color=\"default\"\n          onClick={() => doEditScreen(condition.getIn(['action', 'screen']))}\n          className={classes.margin}\n        >\n          Rediger slutning\n        </Button>\n        <ImageDialog\n          title=\"Vælg pokalbillede\"\n          setImageUrl={url =>\n            doUpdateDispatch(o =>\n              o.setIn(['action', 'set', 'trophy', 'image'], url)\n            )\n          }\n        />\n        <Button\n          className={classes.margin}\n          variant=\"fab\"\n          aria-label=\"Delete\"\n          mini\n          onClick={doDeleteDispatch}\n        >\n          <DeleteIcon />\n        </Button>\n      </Paper>\n    </Grid>\n  );\n}\nfunction editDispatch({\n  currentScreen,\n  classes,\n  doEditScreen,\n  doUpdateDispatch,\n  doDeleteDispatch,\n  doAddDispatch\n}) {\n  return (\n    <Grid container spacing={16}>\n      {currentScreen\n        .get('dispatch')\n        .butLast()\n        .map((o, pos) =>\n          editCondition(o, {\n            classes,\n            doEditScreen,\n            doUpdateDispatch: doUpdateDispatch(currentScreen.get('_id'), pos),\n            doDeleteDispatch: doDeleteDispatch(currentScreen.get('_id'), pos)\n          })\n        )}\n      <Grid item xs={12}>\n        <Button\n          aria-label=\"Add\"\n          mini\n          onClick={() => doAddDispatch(currentScreen.get('_id'))}\n        >\n          <AddIcon /> Mulig slutning\n        </Button>\n        <Button\n          variant=\"contained\"\n          color=\"default\"\n          onClick={() =>\n            doEditScreen(\n              currentScreen\n                .get('dispatch')\n                .last()\n                .getIn(['action', 'screen'])\n            )\n          }\n          className={classes.margin}\n        >\n          Rediger default slutning\n        </Button>\n      </Grid>\n    </Grid>\n  );\n}\n\nexport class EditScreen extends Component {\n  render() {\n    const {currentScreen, doEditScreen} = this.props;\n    return (\n      <Grid container spacing={16}>\n        <Grid item xs={12}>\n          <Typography variant=\"h5\" gutterBottom>\n            Rediger quiz-skærm\n          </Typography>\n          <Button onClick={() => doEditScreen(currentScreen.get('parent', ''))}>\n            <ArrowBackIcon />\n            Tilbage\n          </Button>\n        </Grid>\n        {currentScreen.get('ui')\n          ? editUI(this.props)\n          : currentScreen.get('dispatch')\n            ? editDispatch(this.props)\n            : 'Error: unsupported screen'}\n      </Grid>\n    );\n  }\n}\n\nexport function mapStateToProps(state, ownProps) {\n  return {\n    currentScreen: getScreen(adminCurrentScreen(state), state)\n  };\n}\nexport function mapDispatchToProps(dispatch) {\n  return {\n    doEditScreen: screen => dispatch(editScreen({screen})),\n    doAddDispatch: screen => dispatch(addDispatch(screen)),\n    doDeleteDispatch: (screen, pos) => () =>\n      dispatch(deleteDispatch({screen, pos})),\n    doUpdateScreenElement: (screen, pos) => updateFn =>\n      dispatch(updateScreenElement({screen, pos, updateFn})),\n    doUpdateDispatch: (screen, pos) => updateFn =>\n      dispatch(updateDispatch({screen, pos, updateFn})),\n    doAddQuestionAnswer: (screen, pos) =>\n      dispatch(addQuestionAnswer([screen, pos]))\n  };\n}\n\nexport default withStyles(style)(\n  connect(\n    mapStateToProps,\n    mapDispatchToProps\n  )(EditScreen)\n);\n","import {connect} from 'react-redux';\nimport React, {Component} from 'react';\nimport AddIcon from '@material-ui/icons/Add';\nimport Button from '@material-ui/core/Button';\nimport {ChromePicker} from 'react-color';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport {DragDropContext, Droppable, Draggable} from 'react-beautiful-dnd';\nimport DragIndicatorIcon from '@material-ui/icons/DragIndicator';\nimport FormControl from '@material-ui/core/FormControl';\nimport Grid from '@material-ui/core/Grid';\nimport Input from '@material-ui/core/Input';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport Typography from '@material-ui/core/Typography';\nimport style from './style';\nimport {ImageDialog, Image} from './ImageDialog';\nimport {withStyles} from '@material-ui/core/styles';\nimport Tooltip from '@material-ui/core/Tooltip';\n\nimport {\n  adminCurrentScreen,\n  quizSettings,\n  loading,\n  questionList,\n  getScreen\n} from '../redux/selectors';\nimport {\n  addQuestionSection,\n  deleteSection,\n  updateSetting,\n  editScreen,\n  moveSection,\n  adminQuizList\n} from '../redux/actions';\n\nfunction draggable(onMoveSection, items) {\n  return (\n    <DragDropContext\n      onDragEnd={o =>\n        o.destination &&\n        onMoveSection({\n          id: o.draggableId,\n          from: o.source.index,\n          to: o.destination.index,\n          screens: items.map(o => o.id)\n        })\n      }\n    >\n      <Droppable droppableId=\"droppable\">\n        {(droppableProvided, droppableSnapshot) => (\n          <div ref={droppableProvided.innerRef}>\n            {items.map((item, index) => (\n              <Draggable key={item.id} draggableId={item.id} index={index}>\n                {(draggableProvided, draggableSnapshot) => (\n                  <div\n                    ref={draggableProvided.innerRef}\n                    {...draggableProvided.draggableProps}\n                    {...draggableProvided.dragHandleProps}\n                  >\n                    {item.content}\n                  </div>\n                )}\n              </Draggable>\n            ))}\n            {droppableProvided.placeholder}\n          </div>\n        )}\n      </Droppable>\n    </DragDropContext>\n  );\n}\nfunction quizSection({screen, doEdit, doDelete, classes}) {\n  const notDraggable = !!(\n    screen.get('dispatch', false) || screen.get('start', false)\n  );\n  return (\n    <Grid container spacing={8}>\n      <Grid item xs={1}>\n        {!notDraggable && <DragIndicatorIcon />}\n      </Grid>\n      <Grid item xs={10}>\n        <Button\n          className={classes.button}\n          variant=\"contained\"\n          fullWidth={true}\n          onClick={doEdit}\n        >\n          <Typography variant=\"button\" noWrap>\n            {screen\n              .get('ui', [])\n              .map(uiElem => uiElem.get('text', ''))\n              .join(' ') + (notDraggable ? 'Quiz-afslutninger' : '')}\n          </Typography>\n        </Button>\n      </Grid>\n      <Grid item xs={1}>\n        {!notDraggable && (\n          <Button variant=\"fab\" aria-label=\"Delete\" mini onClick={doDelete}>\n            <DeleteIcon />\n          </Button>\n        )}\n      </Grid>\n    </Grid>\n  );\n}\n\nexport class EditQuiz extends Component {\n  render() {\n    const {\n      questions,\n      settings,\n      classes,\n      updateSetting,\n      moveSection,\n      editScreen,\n      deleteSection,\n      addQuestionSection,\n      adminQuizList\n    } = this.props;\n    return (\n      <Grid container spacing={16}>\n        <Button\n          className={classes.button}\n          fullWidth={true}\n          onClick={adminQuizList}\n        >\n          Vælg quiz\n        </Button>\n        {renderDescriptionSettings({classes, settings, updateSetting})}\n        {renderQuestionList({\n          addQuestionSection,\n          questions,\n          classes,\n          moveSection,\n          deleteSection,\n          editScreen\n        })}\n        {renderVisualSettings({classes, settings, updateSetting})}\n      </Grid>\n    );\n  }\n}\n\nfunction renderDescriptionSettings({classes, settings, updateSetting}) {\n  return (\n    <Grid item xs={12}>\n      <Typography variant=\"h5\" gutterBottom>\n        Quiz beskrivelse\n      </Typography>\n      <Typography>\n        Quiz id / indlejring:{' '}\n        <a\n          target=\"_blank\"\n          href={'https://quiz.dbc.dk/widget?' + settings.get('_id')}\n        >\n          {settings.get('_id')}\n        </a>\n      </Typography>\n      <FormControl fullWidth className={classes.margin}>\n        <InputLabel htmlFor=\"title\">Titel</InputLabel>\n        <Input\n          id=\"title\"\n          value={settings.get('title')}\n          onChange={o => updateSetting(['title'], o.target.value)}\n        />\n      </FormControl>\n      <Tooltip title=\"Beskrivelsen bruges kun i admin-grænsefladen, til at notere hvad quiz'en handler om\">\n        <FormControl fullWidth className={classes.margin}>\n          <InputLabel htmlFor=\"description\">Beskrivelse</InputLabel>\n          <Input\n            id=\"description\"\n            value={settings.get('description')}\n            onChange={o => updateSetting(['description'], o.target.value)}\n          />\n        </FormControl>\n      </Tooltip>\n      <FormControl fullWidth className={classes.margin}>\n        <InputLabel htmlFor=\"tags\">Tags</InputLabel>\n        <Input\n          id=\"tags\"\n          value={settings\n            .get('tags')\n            .toJS()\n            .join(' ')}\n          onChange={o =>\n            updateSetting(\n              ['tags'],\n              o.target.value.replace(/[,]/g, '').split(/ +/)\n            )\n          }\n        />\n      </FormControl>\n    </Grid>\n  );\n}\nfunction renderQuestionList({\n  addQuestionSection,\n  questions,\n  classes,\n  moveSection,\n  deleteSection,\n  editScreen\n}) {\n  return (\n    <Grid item xs={12}>\n      <Typography variant=\"h5\" gutterBottom>\n        Spørgsmål og indhold\n      </Typography>\n      {!!questions.length &&\n        draggable(\n          moveSection,\n          questions.map(q => {\n            const id = q.get('_id');\n            return {\n              id,\n              content: quizSection({\n                classes: classes,\n                screen: q,\n                doEdit: () => editScreen(id),\n                doDelete: () => deleteSection(id)\n              })\n            };\n          })\n        )}\n      <Button\n        onClick={() =>\n          addQuestionSection(questions[questions.length - 1].get('_id'))\n        }\n      >\n        <AddIcon />\n        Spørgsmål\n      </Button>\n      <div />\n    </Grid>\n  );\n}\nfunction renderVisualSettings({classes, settings, updateSetting}) {\n  return (\n    <Grid item xs={12}>\n      <Typography variant=\"h5\" gutterBottom>\n        Udseende\n      </Typography>\n      <div>\n        <Image url={settings.get('backgroundImage', '')} height={100} />\n        <br />\n        <ImageDialog\n          classes={classes}\n          imageUrl={settings.get('backgroundImage', '')}\n          setImageUrl={url => updateSetting(['backgroundImage'], url)}\n          title=\"Vælg baggrundsbillede\"\n        />\n      </div>\n      <Typography variant=\"h6\" gutterBottom>\n        Farveskema\n      </Typography>\n      <Grid container spacing={16}>\n        <Grid item>\n          Primærfarve\n          <br />\n          <ChromePicker\n            disableAlpha\n            id=\"primaryColor\"\n            color={settings.getIn(['style', 'primaryColor'], '#C0FFEE')}\n            onChangeComplete={o =>\n              updateSetting(['style', 'primaryColor'], o.hex)\n            }\n          />\n        </Grid>\n        <Grid item>\n          Sekundærfarve\n          <br />\n          <ChromePicker\n            disableAlpha\n            id=\"buttonColor\"\n            color={settings.getIn(['style', 'secondaryColor'], '#BA0BAB')}\n            onChangeComplete={o =>\n              updateSetting(['style', 'secondaryColor'], o.hex)\n            }\n          />\n        </Grid>\n        <Grid item>\n          Baggrundsfarve\n          <br />\n          <ChromePicker\n            id=\"backgroundColor\"\n            color={JSON.parse(\n              settings.getIn(\n                ['style', 'backgroundColor'],\n                '{\"r\":255, \"g\":255, \"b\":255, \"a\": 0.7}'\n              )\n            )}\n            onChangeComplete={o =>\n              updateSetting(['style', 'backgroundColor'], JSON.stringify(o.rgb))\n            }\n          />\n        </Grid>\n      </Grid>\n    </Grid>\n  );\n}\n\nexport function mapStateToProps(state, ownProps) {\n  return {\n    questions: questionList(state).map(questionId =>\n      getScreen(questionId, state).set('_id', questionId)\n    ),\n    settings: quizSettings(state),\n    currentScreen: getScreen(adminCurrentScreen(state), state),\n    loading: loading(state)\n  };\n}\n\nexport function mapDispatchToProps(dispatch) {\n  return {\n    editScreen: screen => dispatch(editScreen({screen})),\n    moveSection: o => dispatch(moveSection(o)),\n    deleteSection: o => dispatch(deleteSection(o)),\n    addQuestionSection: before => dispatch(addQuestionSection({before})),\n    updateSetting: (path, setting) => dispatch(updateSetting(path, setting)),\n    adminQuizList: () => dispatch(adminQuizList())\n  };\n}\n\nexport default withStyles(style)(\n  connect(\n    mapStateToProps,\n    mapDispatchToProps\n  )(EditQuiz)\n);\n","import {connect} from 'react-redux';\nimport React, {Component} from 'react';\nimport _ from 'lodash';\nimport Immutable from 'immutable';\n\nimport AddIcon from '@material-ui/icons/Add';\nimport Button from '@material-ui/core/Button';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport BarChartIcon from '@material-ui/icons/BarChart';\nimport FileCopyIcon from '@material-ui/icons/FileCopy';\nimport SearchIcon from '@material-ui/icons/Search';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport Grid from '@material-ui/core/Grid';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport ListItemSecondaryAction from '@material-ui/core/ListItemSecondaryAction';\nimport Switch from '@material-ui/core/Switch';\nimport Typography from '@material-ui/core/Typography';\nimport TextField from '@material-ui/core/TextField';\nimport IconButton from '@material-ui/core/IconButton';\nimport InputAdornment from '@material-ui/core/InputAdornment';\nimport style from './style';\nimport {withStyles} from '@material-ui/core/styles';\nimport CircularProgress from '@material-ui/core/CircularProgress';\n\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogActions from '@material-ui/core/DialogActions';\n\nimport {\n  statistics,\n  storageUser,\n  searchResults,\n  searchQuery,\n  quizQuestionList\n} from '../redux/selectors';\nimport {\n  showStatistics,\n  hideStatistics,\n  addQuiz,\n  setQuiz,\n  deleteQuiz,\n  changeSearchQuery,\n  toggleSearchOwnOnly\n} from '../redux/actions';\n\nclass DeleteButton extends Component {\n  constructor() {\n    super();\n    this.state = {dialog: false};\n  }\n  render() {\n    return [\n      <IconButton\n        aria-label=\"Search\"\n        onClick={() => this.setState({dialog: true})}\n      >\n        <DeleteIcon />\n      </IconButton>,\n      <Dialog\n        open={this.state.dialog}\n        onClose={() => this.setState({dialog: false})}\n      >\n        <DialogTitle>Vil du slette quiz'en?</DialogTitle>\n        <DialogContent>\n          <DialogContentText id=\"alert-dialog-description\">\n            <p>\n              Hvis quiz'en slettes, så vil det ikke længere være muligt at tage\n              den.\n            </p>\n            <p>Slettede quiz'er kan ikke gendannes. </p>\n          </DialogContentText>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => this.setState({dialog: false})}>Nej</Button>\n          <Button\n            onClick={() => {\n              this.props.deleteQuiz(this.props.quizId);\n              this.setState({dialog: false});\n            }}\n            color=\"primary\"\n          >\n            Ja\n          </Button>\n        </DialogActions>\n      </Dialog>\n    ];\n  }\n}\n\nclass StatisticsDialog extends Component {\n  render() {\n    let {quiz, hideStatistics, screenHits, dayHits} = this.props;\n    quiz = Immutable.fromJS(quiz);\n    const questions = quizQuestionList(quiz);\n    const screenStat = {};\n    Object.keys(screenHits).forEach(screenId => {\n      const parent = quiz.getIn(['screens', screenId, 'parent'], screenId);\n      screenStat[parent] = screenStat[parent] || [];\n      screenStat[parent].push([screenId, screenHits[screenId]]);\n    });\n    function screenTitle(screen) {\n      let title = '';\n      screen.get('ui', []).forEach(ui => !title && (title = ui.get('text')));\n      return screen.get('dispatch') ? 'Quiz-afslutninger:' : title;\n    }\n\n    const maxDay = Math.max.apply(Math, Object.values(dayHits)) || 1;\n    return (\n      <Dialog onClose={hideStatistics} open={true}>\n        <DialogTitle>\n          Statistik for quiz'en: <small>{quiz.get('title')}</small>\n        </DialogTitle>\n        <DialogContent>\n          <Typography>\n            <strong>Svar-statistik:</strong>\n            <br />\n            {Object.keys(dayHits).length === 0 ? (\n              <center>\n                <CircularProgress />\n              </center>\n            ) : (\n              questions.map(questionId => {\n                const question = quiz.getIn(['screens', questionId]);\n                {\n                  JSON.stringify(\n                    (question.get('ui') || Immutable.List()).filter(\n                      o => o.get('type') === 'buttonGroup'\n                    )\n                  );\n                }\n                let results = question.get('ui');\n                results =\n                  results &&\n                  results.filter(o => o.get('type') === 'buttonGroup').first();\n                results =\n                  results &&\n                  results.get('ui').map(o => o.getIn(['action', 'screen']));\n\n                results =\n                  results ||\n                  (question.get('dispatch') &&\n                    question\n                      .get('dispatch')\n                      .map(o => o.getIn(['action', 'screen'])));\n\n                return (\n                  <p>\n                    {screenHits[questionId] && (\n                      <strong>{screenHits[questionId] || 0}× </strong>\n                    )}{' '}\n                    {screenTitle(question)}\n                    <ul>\n                      {results &&\n                        results.map(screenId => (\n                          <li>\n                            <strong>{screenHits[screenId] || 0}× </strong>\n                            {screenTitle(quiz.getIn(['screens', screenId]))}\n                          </li>\n                        ))}\n                    </ul>\n                  </p>\n                );\n              })\n            )}\n            <div />\n            <br />\n            <strong>Quiz-visninger:</strong> <br />\n            {Object.keys(dayHits).length === 0 ? (\n              <center>\n                <CircularProgress />\n              </center>\n            ) : (\n              Object.keys(dayHits)\n                .sort()\n                .reverse()\n                .map(date => (\n                  <small>\n                    {' '}\n                    {date}:{' '}\n                    <span\n                      style={{\n                        display: 'inline-block',\n                        width: (dayHits[date] / maxDay) * 60 + '%',\n                        background: 'rgba(0,0,255,.3)',\n                        margin: '1px'\n                      }}\n                    >\n                      &nbsp;\n                      {dayHits[date]}\n                    </span>\n                    <br />\n                  </small>\n                ))\n            )}\n          </Typography>\n        </DialogContent>\n      </Dialog>\n    );\n  }\n}\n\nexport class QuizList extends Component {\n  render() {\n    const {\n      showStatistics,\n      hideStatistics,\n      statistics,\n      deleteQuiz,\n      classes,\n      searchResults,\n      newQuiz,\n      setQuiz,\n      query,\n      changeQuery,\n      ownOnly,\n      toggleOwnOnly,\n      doSearch,\n      userName,\n      copy\n    } = this.props;\n    return (\n      <Grid container spacing={16}>\n        <Grid item xs={12}>\n          <Button onClick={newQuiz}>\n            <AddIcon /> Ny Quiz{' '}\n          </Button>\n        </Grid>\n        <Grid item xs={12}>\n          <TextField\n            fullWidth\n            variant=\"outlined\"\n            label=\"Find quiz\"\n            value={query}\n            onChange={e => changeQuery(e.target.value)}\n            InputProps={{\n              labelWidth: 64,\n              endAdornment: (\n                <InputAdornment position=\"end\">\n                  <IconButton aria-label=\"Search\" onClick={doSearch}>\n                    <SearchIcon />\n                  </IconButton>\n                </InputAdornment>\n              )\n            }}\n          />\n          <div>\n            <FormControlLabel\n              control={<Switch checked={ownOnly} onChange={toggleOwnOnly} />}\n              label=\"Kun egne quizzer\"\n            />\n          </div>\n        </Grid>\n        <Grid item xs={12}>\n          {statistics && (\n            <StatisticsDialog\n              quiz={statistics.quiz}\n              dayHits={statistics.dayHits}\n              screenHits={statistics.screenHits}\n              hideStatistics={hideStatistics}\n            />\n          )}\n          <List>\n            {searchResults.map(o => {\n              const isOwn = o.get('_owner') === userName;\n              return (\n                <ListItem\n                  key={o.get('_id')}\n                  button\n                  onClick={() =>\n                    isOwn\n                      ? setQuiz(o)\n                      : window.open(\n                          'https://quiz.dbc.dk/widget?' + o.get('_id')\n                        )\n                  }\n                >\n                  <ListItemText>\n                    {isOwn ? (\n                      <strong className={classes.margin}>\n                        {o.get('title')}\n                      </strong>\n                    ) : (\n                      <span className={classes.margin}>{o.get('title')}</span>\n                    )}\n                    {o.get('tags', []).map(tag => (\n                      <small key={tag} className={classes.margin}>\n                        {isOwn ? tag : <small>{tag}</small>}\n                      </small>\n                    ))}\n                    <br />\n                    <small className={classes.margin}>\n                      {o.get('_version')} {o.get('_owner')}\n                    </small>\n                  </ListItemText>\n                  <ListItemSecondaryAction>\n                    {isOwn && (\n                      <DeleteButton\n                        deleteQuiz={deleteQuiz}\n                        quizId={o.get('_id')}\n                      />\n                    )}\n                    <IconButton aria-label=\"Copy\" onClick={() => copy(o)}>\n                      <FileCopyIcon />\n                    </IconButton>\n                    <IconButton\n                      aria-label=\"Statistics\"\n                      onClick={() => showStatistics(o)}\n                    >\n                      <BarChartIcon />\n                    </IconButton>\n                  </ListItemSecondaryAction>\n                </ListItem>\n              );\n            })}\n          </List>\n        </Grid>\n      </Grid>\n    );\n  }\n}\n\nexport function mapStateToProps(state, ownProps) {\n  return {\n    searchResults: searchResults(state),\n    ...searchQuery(state),\n    userName: storageUser(state),\n    statistics: statistics(state)\n  };\n}\n\nexport function mapDispatchToProps(dispatch) {\n  return {\n    showStatistics: quiz => dispatch(showStatistics(quiz)),\n    hideStatistics: () => dispatch(hideStatistics()),\n    setQuiz: quiz => dispatch(setQuiz(quiz)),\n    deleteQuiz: quiz => dispatch(deleteQuiz(quiz)),\n    newQuiz: () => dispatch(addQuiz()),\n    doSearch: () => {},\n    copy: quiz =>\n      dispatch(\n        addQuiz(\n          quiz\n            .delete('_id')\n            .delete('_version')\n            .delete('_owner')\n        )\n      ),\n    toggleOwnOnly: () => dispatch(toggleSearchOwnOnly()),\n    changeQuery: q => dispatch(changeSearchQuery(q))\n  };\n}\n\nexport default withStyles(style)(\n  connect(\n    mapStateToProps,\n    mapDispatchToProps\n  )(QuizList)\n);\n","import {connect} from 'react-redux';\nimport React, {Component} from 'react';\n\nimport EditScreen from './EditScreen';\nimport EditQuiz from './EditQuiz';\nimport QuizList from './QuizList';\n\nimport {\n  adminCurrentScreen,\n  currentQuiz,\n  getScreen,\n  loading\n} from '../redux/selectors';\n\nexport class Admin extends Component {\n  render() {\n    if (this.props.currentScreen) {\n      return <EditScreen />;\n    }\n    if (this.props.currentQuiz) {\n      return <EditQuiz />;\n    }\n    return <QuizList />;\n  }\n}\n\nexport function mapStateToProps(state, ownProps) {\n  return {\n    currentScreen: getScreen(adminCurrentScreen(state), state),\n    currentQuiz: currentQuiz(state),\n    loading: loading(state)\n  };\n}\n\nexport default connect(mapStateToProps)(Admin);\n","import Immutable from 'immutable';\n\nconst sampleState = Immutable.fromJS({\n  admin: {\n    // edit a single screen if currentScreen is set\n    currentScreen: undefined\n  },\n  widget: {\n    // will be set to true, when all data is loaded\n    initialised: false,\n    // non-zero if loading, increases with each load operation, and decreases when done\n    loading: 0,\n    currentScreen: undefined\n  },\n  quizState: {},\n\n  // data for the current Quiz\n  quiz: undefined,\n\n  searchQuery: {\n    query: '',\n    ownOnly: true\n  },\n\n  searchResults: [],\n\n  storage: {\n    // storage user id, initialised on start\n    user: undefined,\n\n    // storage type uuids, initialised on start\n    quizType: undefined,\n    imageType: undefined,\n\n    // mirror of data in storage, used for to find local changes to sync to storage\n    quiz: {},\n    page: {}\n  }\n});\n\nexport default sampleState;\n","import Immutable from 'immutable';\nimport assert from 'assert';\n\nfunction deepReplace(o, from, to) {\n  if (o.map) {\n    return o.map(v => deepReplace(v, from, to));\n  }\n  if (o === from) {\n    return to;\n  }\n  return o;\n}\n\nexport function addSection(quiz, {screenId, screens, before}) {\n  screens = Immutable.fromJS(screens);\n\n  let needsReplace = Immutable.Set([quiz.get('start')]);\n  let prevSet;\n  do {\n    prevSet = needsReplace;\n    /* eslint-disable no-loop-func */\n    prevSet.forEach(screenId => {\n      const children = findScreenActions(quiz.getIn(['screens', screenId]));\n      children.forEach(child => {\n        if (child !== before) {\n          needsReplace = needsReplace.add(child);\n        }\n      });\n    });\n  } while (!prevSet.equals(needsReplace));\n\n  needsReplace.forEach(replaceInId => {\n    quiz = quiz.updateIn(['screens', replaceInId], screen =>\n      deepReplace(screen, before, screenId)\n    );\n  });\n\n  assert(screens.getIn([screenId, 'nextSection']));\n  screens = deepReplace(\n    screens,\n    screens.getIn([screenId, 'nextSection'], before),\n    before\n  );\n  quiz = quiz.set('screens', quiz.get('screens').merge(screens));\n\n  return quiz;\n}\n\nfunction sectionScreens(quiz, sectionId) {\n  const screens = [sectionId];\n  let count;\n  do {\n    count = screens.length;\n    for (const [screenId, screen] of quiz.get('screens')) {\n      const parent = screen.get('parent');\n      if (screens.includes(parent) && !screens.includes(screenId)) {\n        screens.push(screenId);\n      }\n    }\n  } while (count !== screens.length);\n  return screens;\n}\n\nexport function deleteSection(quiz, id) {\n  let screens = quiz.get('screens');\n  const next = screens.getIn([id, 'nextSection']);\n\n  const toDelete = sectionScreens(quiz, id);\n  screens = screens.filter((screen, screenId) => !toDelete.includes(screenId));\n  quiz = quiz.set('screens', screens);\n\n  return deepReplace(quiz, id, next);\n}\n\nexport function findScreenActions(o, acc = []) {\n  if (Immutable.isCollection(o)) {\n    const screen = o.getIn(['action', 'screen']);\n    if (screen) {\n      acc.push(screen);\n    }\n    o.forEach(v => findScreenActions(v, acc));\n  }\n  return acc;\n}\n\nexport function moveSection(state, action) {\n  const {screens, from, to} = action;\n  if (\n    (typeof to === 'number' && from === screens.length - 1) ||\n    to === screens.length - 1 ||\n    to === 0\n  ) {\n    return state;\n  }\n  const movedElem = screens[from];\n  const insertBeforeId = screens[(to + (from > to ? 0 : 1)) % screens.length];\n  let movedScreens = sectionScreens(state.get('quiz'), movedElem);\n  movedScreens = movedScreens.map(id => [\n    id,\n    state.getIn(['quiz', 'screens', id])\n  ]);\n  movedScreens = new Immutable.Map(movedScreens);\n  let quiz = deleteSection(state.get('quiz'), movedElem);\n  quiz = addSection(quiz, {\n    before: insertBeforeId,\n    screenId: movedElem,\n    screens: movedScreens\n  });\n  return state.set('quiz', quiz);\n}\n","import sampleState from './sampleState';\nimport {storage} from './openplatform';\nimport {\n  dispatchActionData,\n  infoScreenData,\n  answerButtonData\n} from '../quizData';\nimport {moveSection, deleteSection, addSection} from './quizElements';\nimport Immutable from 'immutable';\nimport uuidv4 from 'uuid/v4';\n\nconst initialState = sampleState;\n\nfunction pageAction(state, action) {\n  let {screen, increment, set, callback} = action.action;\n\n  if (screen) {\n    state = state.setIn(['widget', 'currentScreen'], screen);\n    const dispatch = state.getIn(['quiz', 'screens', screen, 'dispatch']);\n    if (dispatch) {\n      for (const dispatchCase of dispatch.toJS()) {\n        if (dispatchCase.condition) {\n          let ok = true;\n          for (const conditionType in dispatchCase.condition) {\n            if (conditionType === 'atLeast') {\n              for (const variable in dispatchCase.condition.atLeast) {\n                const value = state.getIn(['quizState', variable], 0);\n                if (value < dispatchCase.condition.atLeast[variable]) {\n                  ok = false;\n                }\n              }\n            } else {\n              throw new Error('invalid conditionType:', conditionType);\n            }\n          }\n          if (ok) {\n            return pageAction(state, {action: dispatchCase.action});\n          }\n        } else {\n          return pageAction(state, {action: dispatchCase.action});\n        }\n      }\n    }\n    if (!!state.getIn(['quiz', 'screens', screen, 'log'])) {\n      storage.put({\n        _type: 'openplatform.quizStatistics',\n        date: new Date().toISOString().slice(0, 10),\n        quiz: state.getIn(['quiz', '_id']),\n        type: 'screen',\n        subtype: screen\n      });\n    }\n  }\n\n  if (increment) {\n    for (const variable in increment) {\n      state = state.updateIn(\n        ['quizState', variable],\n        i => (i || 0) + increment[variable]\n      );\n    }\n  }\n\n  if (set) {\n    state = state.update('quizState', quizState =>\n      quizState.merge(Immutable.fromJS(set))\n    );\n  }\n\n  if (callback) {\n    try {\n      state.getIn(['widget', 'onDone'], () => {})(\n        state.get('quizState').toJS()\n      );\n    } catch (e) {\n      console.error(\n        'Error in quiz embedding, exception during onDone callback:',\n        e\n      );\n    }\n  }\n\n  return state;\n}\nfunction sortDispatchesByAtLeastScore(state, screen) {\n  return state.updateIn(['quiz', 'screens', screen, 'dispatch'], o =>\n    o.sort(\n      (a, b) =>\n        b.getIn(['condition', 'atLeast', 'score'], -1) -\n        a.getIn(['condition', 'atLeast', 'score'], -1)\n    )\n  );\n}\n\nexport function root(state = initialState, action) {\n  switch (action.type) {\n    case '@@INIT': {\n      return state;\n    }\n    case 'STATISTICS': {\n      return state.set('statistics', action.statistics);\n    }\n    case 'ONDONE_CALLBACK': {\n      return state.setIn(['widget', 'onDone'], action.fn);\n    }\n    case 'ADD_DISPATCH': {\n      const newScreen = uuidv4();\n      state = state.setIn(\n        ['quiz', 'screens', newScreen],\n        Immutable.fromJS(\n          infoScreenData({\n            _id: newScreen,\n            parent: action.screen,\n            action: {\n              screen: state.getIn(['quiz', 'start'])\n            },\n            text:\n              'Tillykke, du havde {{correct}} ud af {{questionCount}} rigtige',\n            buttonText: 'Prøv igen'\n          })\n        )\n      );\n      state = state.updateIn(\n        ['quiz', 'screens', action.screen, 'dispatch'],\n        o => o.push(Immutable.fromJS(dispatchActionData({screen: newScreen})))\n      );\n      return sortDispatchesByAtLeastScore(state, action.screen);\n    }\n    case 'DELETE_DISPATCH': {\n      state = state.updateIn(\n        ['quiz', 'screens', action.screen, 'dispatch'],\n        o => o.delete(action.pos)\n      );\n      // TODO: prune orphaned screens\n      return state;\n    }\n    case 'UPDATE_DISPATCH': {\n      state = state.updateIn(\n        ['quiz', 'screens', action.screen, 'dispatch', action.pos],\n        action.updateFn\n      );\n      return sortDispatchesByAtLeastScore(state, action.screen);\n    }\n    case 'UPDATE_SCREEN_ELEMENT': {\n      state = state.updateIn(\n        ['quiz', 'screens', action.screen, 'ui', action.pos],\n        action.updateFn\n      );\n      // TODO: prune orphaned screens\n      return state;\n    }\n    case 'UPDATE_QUIZ_SETTING': {\n      return state.setIn(\n        ['quiz'].concat(action.path),\n        Immutable.fromJS(action.setting)\n      );\n    }\n    case 'INITIALISED': {\n      return state.mergeDeep(action.state);\n    }\n    case 'SEARCH_RESULTS': {\n      return state.set('searchResults', Immutable.fromJS(action.searchResults));\n    }\n    case 'LOADING_STARTED': {\n      return state.updateIn(['widget', 'loading'], i => i + 1);\n    }\n    case 'LOADING_DONE': {\n      return state.updateIn(['widget', 'loading'], i => i - 1);\n    }\n    case 'ADMIN_EDIT_SCREEN': {\n      return state.setIn(['admin', 'currentScreen'], action.screen);\n    }\n    case 'PAGE_ACTION': {\n      return pageAction(state, action);\n    }\n    case 'SET_QUIZ': {\n      const quiz = Immutable.fromJS(action.quiz);\n      return pageAction(state.set('quiz', quiz), {\n        action: {screen: quiz.get('start')}\n      });\n    }\n    case 'ADMIN_QUIZ_LIST': {\n      return state.delete('quiz');\n    }\n    case 'ADMIN_ADD_SECTION': {\n      return state.update('quiz', quiz => addSection(quiz, action));\n    }\n    case 'ADMIN_DELETE_SECTION': {\n      return state.update('quiz', quiz => deleteSection(quiz, action.screenId));\n    }\n    case 'ADMIN_MOVE_SECTION': {\n      return moveSection(state, action);\n    }\n    case 'ADD_QUESTION_ANSWER': {\n      const nextScreen = state.getIn([\n        'quiz',\n        'screens',\n        action.path[0],\n        'nextSection'\n      ]);\n      const answerScreen = uuidv4();\n      state = state.setIn(\n        ['quiz', 'screens', answerScreen],\n        Immutable.fromJS(\n          infoScreenData({\n            _id: answerScreen,\n            parent: action.path[0],\n            action: {screen: nextScreen}\n          })\n        )\n      );\n\n      state = state.updateIn(\n        ['quiz', 'screens', action.path[0], 'ui', action.path[1], 'ui'],\n        buttonGroupUI =>\n          buttonGroupUI.push(\n            Immutable.fromJS(answerButtonData({nextScreen: answerScreen}))\n          )\n      );\n      return state;\n    }\n    case 'SEARCH_CHANGE_QUERY': {\n      return state.setIn(['searchQuery', 'query'], action.query);\n    }\n    case 'SEARCH_TOGGLE_OWN_ONLY': {\n      return state.updateIn(['searchQuery', 'ownOnly'], value => !value);\n    }\n    default: {\n      console.log('Unrecognised action', action);\n      return state;\n    }\n  }\n}\n","import store from './store';\nimport {storage} from './openplatform';\nimport {searchQuizzes} from './actions';\n\nlet prevQuiz;\n\nlet needsSave = false;\nasync function doSave() {\n  needsSave = false;\n  if (!prevQuiz) {\n    return;\n  }\n  await storage.put(prevQuiz.delete('_version').toJS());\n  if (!store.getState().get('quiz')) {\n    store.dispatch(searchQuizzes());\n  }\n  console.log('saved');\n}\n\nfunction scheduleSave() {\n  if (needsSave) {\n    return;\n  }\n  setTimeout(doSave, 5000);\n  needsSave = true;\n}\n\nstore.subscribe(async () => {\n  const quizData = store.getState().get('quiz');\n  if (prevQuiz && quizData && !quizData.equals(prevQuiz)) {\n    scheduleSave();\n  } else if (!quizData && prevQuiz) {\n    if (needsSave) {\n      await doSave();\n    }\n  }\n  prevQuiz = quizData;\n});\n","import {createStore, applyMiddleware, compose} from 'redux';\nimport {root} from './reducers';\nimport thunk from 'redux-thunk';\n\nconst composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\nconst store = createStore(root, composeEnhancers(applyMiddleware(thunk)));\nexport default store;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport QuizWidget from './components/Widget';\nimport QuizAdmin from './components/Admin';\nimport store from './redux/store';\nimport {init} from './redux/actions';\nimport {} from './redux/autosave';\nimport {Provider} from 'react-redux';\nimport openplatform from './redux/openplatform';\n\nif (typeof window.openPlatformQuiz !== 'object') {\n  window.openPlatformQuiz = {};\n}\n\nwindow.addEventListener('load', () => {\n  if (typeof window.initOpenPlatformQuiz === 'function') {\n    window.initOpenPlatformQuiz();\n  }\n});\n\nasync function mount(Cls, {elemId, onDone, openPlatformToken, quizId}) {\n  openPlatformToken && (await openplatform.connect(openPlatformToken));\n  store.dispatch(init({quizId, onDone}));\n  ReactDOM.render(\n    <Provider store={store}>\n      <Cls />\n    </Provider>,\n    document.getElementById(elemId)\n  );\n}\n\nclass Widget {\n  constructor(args) {\n    mount(QuizWidget, args);\n  }\n}\n\nclass Admin {\n  constructor(args) {\n    mount(QuizAdmin, args);\n  }\n}\n\nwindow.openPlatformQuiz.Widget = Widget;\nwindow.openPlatformQuiz.Admin = Admin;\nwindow.openPlatformQuiz.statisticsEvent = async ({\n  openPlatformToken,\n  quizId,\n  type,\n  subtype\n}) => {\n  openPlatformToken && (await openplatform.connect(openPlatformToken));\n  if (quizId === undefined) throw new Error('missing quizId');\n  if (type === undefined) throw new Error('missing type');\n  if (subtype === undefined) throw new Error('missing subtype');\n  openplatform.storage.put({\n    _type: 'openplatform.quizStatistics',\n    date: new Date().toISOString().slice(0, 10),\n    quiz: quizId,\n    type,\n    subtype\n  });\n};\n\nif (module.hot) {\n  module.hot.accept(['./components/Widget', './components/Admin'], () =>\n    window.initOpenPlatformQuiz()\n  );\n}\n"],"sourceRoot":""}